<form class="{{cssClass}} flexcol" autocomplete="off">

    {{!-- Sheet Header --}}
    <header class="sheet-header flexrow">
        <img class="profile" src="{{action.img}}" title="{{action.name}}" data-edit="img">
        <h1 class="title">
            <input name="name" type="text" value="{{action.name}}" placeholder="Action Name">
        </h1>
    </header>

    <!-- Configuration Tabs -->
    <nav class="sheet-tabs tabs">
        <a class="item" data-tab="usage"><i class="fa-solid fa-cogs"></i> Usage</a>
        <a class="item" data-tab="target"><i class="fa-solid fa-bullseye"></i> Target</a>
        <a class="item" data-tab="effects"><i class="fa-solid fa-hourglass-clock"></i> Effects</a>
        <a class="item" data-tab="hooks"><i class="fa-solid fa-code"></i> Hooks</a>
    </nav>

    {{!-- Usage Tab --}}
    <section class="tab sheet-body flexcol" data-tab="usage">
        <div class="form-group">
            <label>Action ID</label>
            <div class="form-fields">
                <input type="text" name="id" value="{{action.id}}">
            </div>
            <p class="hint">Provide a standardized camel-case alphanumeric identifier for this action.
                This identifier should be unique across all actions in the system.</p>
        </div>

        <div class="form-group stacked">
            <label>Description</label>
            <textarea name="description" rows="4">{{action.description}}</textarea>
            <p class="hint">A text description of how the action functions mechanically.</p>
        </div>

        <div class="form-group stacked">
            <label>Triggering Condition</label>
            <textarea name="condition" rows="2">{{action.condition}}</textarea>
            <p class="hint">Additional reference text which clarifies the prerequisite triggering conditions under which an action may be used.</p>
        </div>

        <fieldset>
            <legend>Action Tags</legend>
            <div class="form-group stacked">
                <div class="form-fields">
                    <multi-select name="tags">
                        {{#each tags as |optgroup|}}
                        <optgroup label="{{optgroup.label}}">
                            {{#each optgroup.tags as |tag|}}
                                <option value="{{tag.value}}" {{tag.selected}}>{{tag.label}}</option>
                            {{/each}}
                        </optgroup>
                        {{/each}}
                    </multi-select>
                </div>
                <p class="hint">Add tags which define the requirements, behavior, and modifiers of this action.
                    The order of tags matters as later tags will take priority over earlier ones if they modify the
                    same properties of the action.</p>
            </div>
        </fieldset>

        <fieldset>
            <legend>Action Cost</legend>
            <div class="form-group">
                <label>Activation Cost</label>
                <div class="form-fields">
                    <label>Action</label>
                    <input type="number" name="cost.action" value="{{action.cost.action}}">
                    <label>Focus</label>
                    <input type="number" name="cost.focus" value="{{action.cost.focus}}">
                </div>
                <p class="hint">Configure the cost of using this action in Action Points and Focus Points.</p>
            </div>
            <div class="form-group">
                <label>Add Weapon Cost</label>
                <div class="form-fields">
                    <input type="checkbox" name="cost.weapon" {{checked action.cost.weapon}}>
                </div>
                <p class="hint">Is the equipped weapon's Action Point cost added to the cost for this Action?</p>
            </div>
        </fieldset>
    </section>

    {{!-- Target Tab --}}
    <section class="tab sheet-body flexcol" data-tab="target">
        <div class="form-group">
            <label>Affected Scope</label>
            <div class="form-fields">
                <select name="target.scope" data-dtype="Number">
                    {{selectOptions targetScopes selected=action.target.scope}}
                </select>
            </div>
            <p class="hint">Which disposition of targets are affected by this action?</p>
        </div>

        <fieldset>
            <legend>Range</legend>
            <div class="form-group">
                <label>Distance (ft)</label>
                <div class="form-fields">
                    <label>Minimum</label>
                    <input type="number" name="range.minimum" value="{{action.range.minimum}}" min="0" step="1">
                    <label>Maximum</label>
                    <input type="number" name="range.maximum" value="{{action.range.maximum}}" min="0" step="1">
                </div>
                <p class="hint">Define a minimum or maximum range in feet at which this action may be performed.</p>
            </div>
            <div class="form-group">
                <label>Use Weapon Range</label>
                <div class="form-fields">
                    <input type="checkbox" name="range.weapon" {{checked action.range.weapon}}>
                </div>
                <p class="hint">The range of this action is defined by the effective range of the used weapon.</p>
            </div>
        </fieldset>

        <fieldset>
            <legend>Target</legend>
            <div class="form-group">
                <label>Target Type</label>
                <div class="form-fields">
                    <select name="target.type">
                        {{selectOptions targetTypes selected=action.target.type labelAttr="label"}}
                    </select>
                </div>
                <p class="hint">Which type of target or area is affected by this action?</p>
            </div>
            <div class="form-group">
                <label>Target Number</label>
                <div class="form-fields">
                    <input type="number" name="target.number" value="{{action.target.number}}" min="0" step="1">
                </div>
                <p class="hint">How many of the selected target type are affected by this action?</p>
            </div>
            <div class="form-group">
                <label>Target Size (ft)</label>
                <div class="form-fields">
                    <input type="number" name="target.size" value="{{action.target.size}}" min="0" step="1">
                </div>
                <p class="hint">Certain target types are further modified by a size in feet.</p>
            </div>
            <div class="form-group">
                <label>Maximum Targets</label>
                <div class="form-fields">
                    <input type="number" name="target.limit" value="{{action.target.limit}}" min="0" step="1">
                </div>
                <p class="hint">Limit the effect of this action to a maximum number of individual target characters? By default, all targets will be affected.</p>
            </div>
            <div class="form-group">
                <label>Multiple Applications</label>
                <div class="form-fields">
                    <input type="number" name="target.multiple" value="{{action.target.multiple}}" min="0" step="1">
                </div>
                <p class="hint">Apply the effects of this action multiple times per target? By default, the action will apply once per target.</p>
            </div>
        </fieldset>
    </section>

    {{!-- Effects Tab --}}
    <section class="tab sheet-body flexcol" data-tab="effects">
        <button type="button" class="frame-brown" data-action="addEffect">
            <i class="fa-solid fa-plus"></i>
            <span>{{localize "ACTION.EFFECTS.Add"}}</span>
        </button>
        {{#each effects as |effect i|}}
        {{> (lookup @root.partials "effect") effect=effect i=i targetScopes=@root.targetScopes}}
        {{/each}}
    </section>

    {{!-- Hooks Tab --}}
    {{#if showHooks}}
    <section class="tab sheet-body flexcol" data-tab="hooks">
        <p class="hint"><strong>Beware</strong>. This configuration tab involves advanced features for automating
            action effects. Mis-configuring data on this tab can have serious consequences. Do not attempt to
            make changes here unless you are confident in your own knowledge.</p>

        {{#each actionHooks as |hook i|}}
            <div class="form-group stacked">
                <label>
                    <code>{{localize hook.label}}</code>
                    <button type="button" class="icon frame-brown delete-hook" data-action="deleteHook">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </label>
                <input type="hidden" name="actionHooks.{{i}}.hook" value="{{hook.hook}}">
                <textarea name="actionHooks.{{i}}.fn" rows="6">{{hook.fn}}</textarea>
            </div>
        {{/each}}

        <div class="form-group">
            <label>Add Hook</label>
            <div class="form-fields">
                <select name="addHook">
                    {{selectOptions actionHookChoices blank=""}}
                </select>
                <button type="button" class="icon frame-brown" data-action="addHook" data-tooltip="Add Hook">
                    <i class="fa-solid fa-plus"></i>
                </button>
            </div>
        </div>
    </section>
    {{/if}}

    {{!-- Sheet Footer --}}
    {{#if editable}}
    <footer class="sheet-footer">
        <button class="frame-brown" type="submit">
            <i class="fas fa-save"></i> {{localize "Save Changes"}}
        </button>
    </footer>
    {{/if}}
</form>
